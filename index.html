



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="./assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.0">
    
    
      
        <title>valid8</title>
      
    
    
      <link rel="stylesheet" href="./assets/stylesheets/application.2a88008a.css">
      
    
    
      <script src="./assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="valid8" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                valid8
              </span>
              <span class="md-header-nav__topic">
                Home
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/smarie/python-valid8/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    valid8
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/smarie/python-valid8/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Home
      </label>
    
    <a href="." title="Home" class="md-nav__link md-nav__link--active">
      Home
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-would-i-need-a-validation-library" title="Why would I need a validation library ?" class="md-nav__link">
    Why would I need a validation library ?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" title="Installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples-inline" title="Usage examples - inline" class="md-nav__link">
    Usage examples - inline
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic" title="Basic" class="md-nav__link">
    Basic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customization" title="Customization" class="md-nav__link">
    Customization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composition" title="Composition" class="md-nav__link">
    Composition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples-decorators" title="Usage examples - decorators" class="md-nav__link">
    Usage examples - decorators
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validating-function-inputsoutputs" title="Validating function inputs/outputs" class="md-nav__link">
    Validating function inputs/outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-class-fields" title="Validating class fields" class="md-nav__link">
    Validating class fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valid8-other-tools" title="valid8 + other tools" class="md-nav__link">
    valid8 + other tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pep484-type-checkers" title="PEP484 type checkers" class="md-nav__link">
    PEP484 type checkers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoclass" title="autoclass" class="md-nav__link">
    autoclass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attrs" title="attrs" class="md-nav__link">
    attrs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" title="Main features" class="md-nav__link">
    Main features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-validation-libraries" title="Other Validation libraries" class="md-nav__link">
    Other Validation libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" title="See Also" class="md-nav__link">
    See Also
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" title="Want to contribute ?" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="why_validation/" title="Why validation" class="md-nav__link">
      Why validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="usage/" title="Usage details" class="md-nav__link">
      Usage details
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="base_validation_lib/" title="Built-in validation functions" class="md-nav__link">
      Built-in validation functions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="other_libs/" title="Other validation libs" class="md-nav__link">
      Other validation libs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-would-i-need-a-validation-library" title="Why would I need a validation library ?" class="md-nav__link">
    Why would I need a validation library ?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" title="Installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples-inline" title="Usage examples - inline" class="md-nav__link">
    Usage examples - inline
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic" title="Basic" class="md-nav__link">
    Basic
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#customization" title="Customization" class="md-nav__link">
    Customization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#composition" title="Composition" class="md-nav__link">
    Composition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-examples-decorators" title="Usage examples - decorators" class="md-nav__link">
    Usage examples - decorators
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validating-function-inputsoutputs" title="Validating function inputs/outputs" class="md-nav__link">
    Validating function inputs/outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validating-class-fields" title="Validating class fields" class="md-nav__link">
    Validating class fields
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#valid8-other-tools" title="valid8 + other tools" class="md-nav__link">
    valid8 + other tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pep484-type-checkers" title="PEP484 type checkers" class="md-nav__link">
    PEP484 type checkers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#autoclass" title="autoclass" class="md-nav__link">
    autoclass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attrs" title="attrs" class="md-nav__link">
    attrs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" title="Main features" class="md-nav__link">
    Main features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-validation-libraries" title="Other Validation libraries" class="md-nav__link">
    Other Validation libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" title="See Also" class="md-nav__link">
    See Also
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" title="Want to contribute ?" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-valid8/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="python-validate-valid8">python-validate (valid8)<a class="headerlink" href="#python-validate-valid8" title="Permanent link">&para;</a></h1>
<p><a href="https://travis-ci.org/smarie/python-valid8"><img alt="Build Status" src="https://travis-ci.org/smarie/python-valid8.svg?branch=master" /></a> <a href="https://smarie.github.io/python-valid8/junit/report.html"><img alt="Tests Status" src="https://smarie.github.io/python-valid8/junit/junit-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-valid8"><img alt="codecov" src="https://codecov.io/gh/smarie/python-valid8/branch/master/graph/badge.svg" /></a> <a href="https://smarie.github.io/python-valid8/"><img alt="Documentation" src="https://img.shields.io/badge/docs-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/valid8/"><img alt="PyPI" src="https://img.shields.io/badge/PyPI-valid8-blue.svg" /></a></p>
<p><em>"valid8ing is not a crime" ;-)</em></p>
<p>As always unfortunately it starts with <em>"I could not find a validation library out there fitting my needs so I built my own"</em>. Almost. To be a little bit more precise, when it all started, I was just looking for a library providing a <code>@validate</code> annotation with a basic library of validators and some logic to associate them, so as to complete <a href="https://smarie.github.io/python-autoclass/">autoclass</a>. I searched and found tons of good and less good libraries <a href="#other-validation-libraries">out there</a>. However none of them was really a good fit for <code>autoclass</code>, for diverse reasons:</p>
<ul>
<li>only a few of them were available as decorators</li>
<li>many of them were strongly mixing type validation and value validation, which is not necessary anymore thanks to PEP484. This was making the <code>autoclass</code> examples more confusing.</li>
<li>only a few of them were providing a simple yet consistent and reusable framework to deal with validation functions, combine them, etc. And the good ones were based on defining a Schema first, which seemed a bit 'too much' for me already.</li>
<li>finally, none of them was really encouraging the community to collaborate by displaying a catalog of base validation functions per data type, open to contributions.</li>
</ul>
<p>So I first created the <code>@validate</code> goodie in <a href="https://smarie.github.io/python-autoclass/">autoclass</a>. When the project became more mature, I decided to extract it and make it independent, so that maybe the community will find it interesting. </p>
<p>When this project grew, I found that its <a href="./base_validation_lib">embedded library of base validation functions</a> was not flexible enough to cover a large variety of use cases, and will probably <strong>never</strong> be even if we try our best, so I came up with the complementary <a href="https://smarie.github.io/python-mini-lambda/">mini_lambda syntax</a> which is now an independent project, typically used when your base validation function is very specific, but yet quite simple to write in plain python.</p>
<h2 id="why-would-i-need-a-validation-library">Why would I need a validation library ?<a class="headerlink" href="#why-would-i-need-a-validation-library" title="Permanent link">&para;</a></h2>
<p>Defensive programming, user-friendly error messages, app-wide consistency of error types, i18n... We try to dig the topic <a href="./why_validation">here</a>.</p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>&gt; pip install valid8
</pre></div>


<p>Optional but recommended:</p>
<ul>
<li>
<p>If you wish to define your own validation functions dynamically you may wish to also install <a href="https://smarie.github.io/python-mini-lambda/">mini_lambda</a>.</p>
</li>
<li>
<p>Since <code>valid8</code> does not support complex <em>type</em> validation, it is recommended to also install a PEP484 <em>type</em> checker such as <a href="https://github.com/RussBaz/enforce">enforce</a> of <a href="https://github.com/Stewori/pytypes">pytypes</a>.</p>
</li>
<li>
<p>In addition, if you wish to create highly compact object classes with field type+value validation, have a look at <a href="https://smarie.github.io/python-autoclass/">autoclass</a> which is where <code>valid8</code> actually originates from.</p>
</li>
</ul>
<h2 id="usage-examples-inline">Usage examples - inline<a class="headerlink" href="#usage-examples-inline" title="Permanent link">&para;</a></h2>
<h3 id="basic">Basic<a class="headerlink" href="#basic" title="Permanent link">&para;</a></h3>
<p><code>assert_valid</code> is a replacement for <code>assert</code>, to validate some value anywhere in the code (see <a href="./why_validation">here</a> if you wonder why <code>assert</code> is not good enough):</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">assert_valid</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>

<span class="n">surf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="c1"># (1) simplest: one named variable to validate + one validation function</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>

<span class="c1"># (2) native mini_lambda support to define validation functions</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">x</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>The main benefit from this is that you are <strong>guaranteed</strong> that any exception happening in the validation process will be caught and turned into a <code>ValidationError</code>, whatever the cause (<code>None</code> handling, known validation failures, unknown other errors). You therefore do not have to write the usual if/else/try/except wrappers to handle all cases. Yay!</p>
<p>In (1) we used the validation functions from the bundled <a href="./base_validation_lib">validation functions library</a>. In (2) we used <a href="https://smarie.github.io/python-mini-lambda/"><code>mini_lambda</code></a> to define the validation function inline (<code>x &gt; 0</code>). Other options are supported including defining your own validation functions very easily, as explained in the <a href="./usage/">Usage</a> page.</p>
<div class="admonition note">
<p class="admonition-title">Note on type validation</p>
<p>Although simple type validation may be performed using the bundled <code>instance_of</code> or <code>subclass_of</code> function as shown above in (1), <code>valid8</code> is not meant for advanced type validation as it does not "know" anything about types. It is recommended to rely on a proper PEP484 type checker to support type validation more extensively.</p>
</div>
<h3 id="customization">Customization<a class="headerlink" href="#customization" title="Permanent link">&para;</a></h3>
<p>Various options are provided to adapt <code>valid8</code> to your needs:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">NonePolicy</span>

<span class="c1"># (3) explicit validation policy for None (FAIL/SKIP/VALIDATE*)</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">none_policy</span><span class="o">=</span><span class="n">NonePolicy</span><span class="o">.</span><span class="n">FAIL</span><span class="p">)</span>

<span class="c1"># (4) custom error message (exception is still a ValidationError)</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">help_msg</span><span class="o">=</span><span class="s1">&#39;Surface should be positive&#39;</span><span class="p">)</span>

<span class="c1"># (5) *YOUR* error type (recommended to provide unique applicative errors / i18n)</span>
<span class="k">class</span> <span class="nc">InvalidSurface</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be a positive number&#39;</span>

<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">)</span>

<span class="c1"># (6) Templating is supported in all `help_msg` texts</span>
<span class="k">class</span> <span class="nc">InvalidSurface</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be &gt; {minimum}, found {var_value}&#39;</span>

<span class="n">min_value</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc_info</span><span class="p">:</span>
    <span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">min_value</span><span class="p">,</span> 
                 <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="n">min_value</span><span class="p">)</span>
</pre></div>


<h3 id="composition">Composition<a class="headerlink" href="#composition" title="Permanent link">&para;</a></h3>
<p>You can combine several base validation functions together:</p>
<div class="codehilite"><pre><span></span><span class="c1"># (8) composition of several base validation functions...</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>

<span class="c1"># (9) you can still provide a global custom error type</span>
<span class="k">class</span> <span class="nc">InvalidSurface</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
             <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">)</span>

<span class="c1"># (10) you can also provide user-friendly intermediate failure messages/types</span>
<span class="n">assert_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span>
             <span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="s1">&#39;Surface should be between 0 and 10000&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="s1">&#39;Surface should be a multiple of 100&#39;</span><span class="p">),</span>
             <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">)</span>
</pre></div>


<h2 id="usage-examples-decorators">Usage examples - decorators<a class="headerlink" href="#usage-examples-decorators" title="Permanent link">&para;</a></h2>
<h3 id="validating-function-inputsoutputs">Validating function inputs/outputs<a class="headerlink" href="#validating-function-inputsoutputs" title="Permanent link">&para;</a></h3>
<p>You can decorate any function with <code>@validate_arg</code> and <code>@validate_out</code> to validate its inputs and outputs. Both work exactly the same way than <code>assert_valid</code>, but they are a bit smarter when it comes to <code>None</code> handling (see note below). Here is an example where we add validation to a <code>build_house</code> function with two inputs:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_arg</span><span class="p">,</span> <span class="n">validate_out</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>

<span class="c1"># Define our 2 applicative error types</span>
<span class="k">class</span> <span class="nc">InvalidNameError</span><span class="p">(</span><span class="n">InputValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;name should be a non-empty string&#39;</span>

<span class="k">class</span> <span class="nc">InvalidSurfaceError</span><span class="p">(</span><span class="n">InputValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>

<span class="c1"># Apply validation</span>
<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>    <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>             
              <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidNameError</span><span class="p">)</span>
<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
              <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurfaceError</span><span class="p">)</span>
<span class="nd">@validate_out</span><span class="p">(</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">tuple</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_house</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Building house... DONE !&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span>
</pre></div>


<p>Let's try to call it with various input values:</p>
<div class="codehilite"><pre><span></span><span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>    <span class="c1"># Valid</span>
<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">)</span>         <span class="c1"># Valid, see note below</span>
<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>              <span class="c1"># InvalidNameError</span>
<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># InvalidSurfaceError</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note on None handling policies</p>
<p>We saw <a href="#customization">earlier</a> that for <code>assert_valid</code> you can customize the policy so that <code>None</code> are not validated (<code>VALIDATE</code>, the default behaviour) but rather accepted (<code>SKIP</code>) or rejected (<code>FAIL</code>). For function input and output validation, two additional policies may be selected in addition to these 3: the first <code>SKIP_IF_NONABLE_ELSE_VALIDATE</code> (default) will skip validation of <code>None</code> values if the argument has a default value of <code>None</code> in the function signature or if the argument or output has a PEP484 <code>Optional[...]</code> type hint, and otherwise will perform validation as usual. The second, <code>SKIP_IF_NONABLE_ELSE_FAIL</code>, will do the same but its last resort fallback is a failure instead of a validation. </p>
</div>
<h3 id="validating-class-fields">Validating class fields<a class="headerlink" href="#validating-class-fields" title="Permanent link">&para;</a></h3>
<p>You can decorate any class with <code>@validate_field</code> to validate a field defined as </p>
<ul>
<li>a <a href="https://docs.python.org/3.6/howto/descriptor.html#descriptor-example">descriptor</a> - in which case it is equivalent to a <code>@validate_arg</code> added on the <code>__set__</code> function of the descriptor, but with a more user-friendly error message</li>
<li>a <a href="https://docs.python.org/3.6/howto/descriptor.html#properties">property</a>, in which case it is equivalent to a <code>@validate_arg</code> added on the <code>fset</code> function of the descriptor, but with a more user-friendly error message.</li>
<li>or a constructor input, in which case it is equivalent to a <code>@validate_arg</code> added on the constructor. In such case WARNING validation will only be called at initial object creation, not at subsequent field modifications!</li>
</ul>
<p>Here is an example where we add validation to a <code>House</code> class with two fields:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_field</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Len</span>

<span class="k">class</span> <span class="nc">InvalidNameError</span><span class="p">(</span><span class="n">ClassFieldValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;name should be a non-empty string&#39;</span>

<span class="k">class</span> <span class="nc">InvalidSurfaceError</span><span class="p">(</span><span class="n">ClassFieldValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>

<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidNameError</span><span class="p">)</span>
<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
                <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurfaceError</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">House</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">surface</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surface</span>

    <span class="nd">@surface.setter</span>
    <span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__surface</span> <span class="o">=</span> <span class="n">surface</span>
</pre></div>


<p>Let's try it:</p>
<div class="codehilite"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">)</span>  <span class="c1"># valid</span>
<span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>              <span class="c1"># DOES NOT RAISE InvalidNameError (no setter!)</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>            <span class="c1"># InvalidNameError</span>
<span class="n">h</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="mi">10000</span>        <span class="c1"># InvalidSurfaceError</span>
</pre></div>


<h2 id="valid8-other-tools"><code>valid8</code> + other tools<a class="headerlink" href="#valid8-other-tools" title="Permanent link">&para;</a></h2>
<h3 id="pep484-type-checkers">PEP484 type checkers<a class="headerlink" href="#pep484-type-checkers" title="Permanent link">&para;</a></h3>
<p>As said previously, even if you can rely on <code>instance_of</code> and <code>subclass_of</code> for basic type validation, it is not the purpose of <code>valid8</code> to do serious type validation, especially when PEP484 is now mainstream and many type checkers are available. It is better to combine their strengths. </p>
<p>The following snippet shows a <code>build_house</code> function with four inputs <code>name</code>, <code>surface</code>, <code>nb_floors</code>, and <code>with_windows</code>, where:</p>
<ul>
<li>Each input is validated against the expected type thanks to the PEP484 type checking library (<a href="https://github.com/RussBaz/enforce">enforce</a> in this example)</li>
<li>the <code>name</code> and <code>surface</code> attribute are further value-validated with valid8 (<code>len(name) &gt; 0</code> and <code>surface &gt;= 0</code>), with the help of the <code>mini_lambda</code> syntax.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># Imports - for type validation</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Integral</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">enforce</span> <span class="kn">import</span> <span class="n">runtime_validation</span><span class="p">,</span> <span class="n">config</span>
<span class="n">config</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;covariant&#39;</span><span class="p">))</span>  <span class="c1"># type validation will accept subclasses too</span>

<span class="c1"># Imports - for value validation</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_arg</span><span class="p">,</span> <span class="n">is_multiple_of</span><span class="p">,</span> <span class="n">InputValidationError</span>

<span class="c1"># Define our 2 applicative error types</span>
<span class="k">class</span> <span class="nc">InvalidNameError</span><span class="p">(</span><span class="n">InputValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;name should be a non-empty string&#39;</span>

<span class="k">class</span> <span class="nc">InvalidSurfaceError</span><span class="p">(</span><span class="n">InputValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>

<span class="c1"># Apply type + value validation</span>
<span class="nd">@runtime_validation</span>
<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidNameError</span><span class="p">)</span>
<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
              <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurfaceError</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_house</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">surface</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Integral</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> \
        <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Integral</span><span class="p">]]:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Building house... DONE !&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span>
</pre></div>


<p>We can test that validation works:</p>
<div class="codehilite"><pre><span></span><span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>    <span class="c1"># valid</span>
<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">)</span>         <span class="c1"># valid (PEP484 Optional, default=None)</span>

<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>              <span class="c1"># InvalidNameError (valid8)</span>
<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># InvalidSurfaceError (valid8)</span>
<span class="n">build_house</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="mf">100.1</span><span class="p">)</span>        <span class="c1"># RuntimeTypeError (enforce)</span>
</pre></div>


<p><strong>Note concerning PEP484 type validation</strong>: how can you make sure to accept both plain old <code>float</code>, <code>int</code> and <code>bool</code>, as well as their <code>numpy</code> equivalents ? Use the handy <code>Real</code> (=float) and <code>Integral</code> (=int) abstract numeric types provided in the <a href="https://docs.python.org/3.6/library/numbers.html"><code>numbers</code></a> built-in module ! They provide an easy way to support both python primitives AND others, e.g. numpy primitives. Unfortunately no equivalent type is provided for booleans, so in <code>valid8</code> we provide an additional <code>Boolean</code> class supporting numpy, to complete the picture.</p>
<h3 id="autoclass">autoclass<a class="headerlink" href="#autoclass" title="Permanent link">&para;</a></h3>
<p><code>valid8</code> plays well with <a href="https://smarie.github.io/python-autoclass/">autoclass</a>: </p>
<ul>
<li>if you decorate the whole class with <code>@validate_field</code> it will obviously work since <code>autoclass</code> generates plain old properties:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">autoclass</span> <span class="kn">import</span> <span class="n">autoclass</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_arg</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>

<span class="k">class</span> <span class="nc">InvalidNameError</span><span class="p">(</span><span class="n">ClassFieldValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;name should be a non-empty string&#39;</span>

<span class="k">class</span> <span class="nc">InvalidSurfaceError</span><span class="p">(</span><span class="n">ClassFieldValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>

<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidNameError</span><span class="p">)</span>
<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurfaceError</span><span class="p">)</span>
<span class="nd">@autoclass</span>
<span class="k">class</span> <span class="nc">House</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="bp">None</span>   <span class="c1"># Valid (surface is nonable by signature)</span>
<span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>        <span class="c1"># InvalidNameError</span>
<span class="n">h</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># InvalidSurfaceError</span>
</pre></div>


<ul>
<li>if you decorate a class constructor with <code>@validate_arg</code>, the property setters generated by <code>@autoclass</code> will include validation too. </li>
</ul>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">autoclass</span> <span class="kn">import</span> <span class="n">autoclass</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_arg</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span><span class="p">,</span> <span class="n">InputValidationError</span>

<span class="k">class</span> <span class="nc">InvalidNameError</span><span class="p">(</span><span class="n">InputValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;name should be a non-empty string&#39;</span>

<span class="k">class</span> <span class="nc">InvalidSurfaceError</span><span class="p">(</span><span class="n">InputValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>

<span class="nd">@autoclass</span>
<span class="k">class</span> <span class="nc">House</span><span class="p">:</span>

    <span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> 
                  <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidNameError</span><span class="p">)</span>
    <span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> 
                  <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurfaceError</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>

<span class="n">h</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="bp">None</span>   <span class="c1"># Valid (surface is nonable by signature)</span>
<span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>        <span class="c1"># InvalidNameError</span>
<span class="n">h</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="mi">10000</span>  <span class="c1"># InvalidSurfaceError</span>
</pre></div>


<p>Of course you can also add type checking on top of that, see <a href="https://smarie.github.io/python-autoclass/">autoclass documentation</a> for details.</p>
<h3 id="attrs">attrs<a class="headerlink" href="#attrs" title="Permanent link">&para;</a></h3>
<p><code>valid8</code> also integrates well with <a href="http://www.attrs.org/en/stable/">attrs</a>: if you decorate a class with <code>@validate_field</code> it will work because <code>attrs</code> generates a compliant class constructor behind the scenes. However WARNING validation will only be called at initial object creation, not at subsequent field modifications!</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_field</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>

<span class="k">class</span> <span class="nc">InvalidNameError</span><span class="p">(</span><span class="n">ClassFieldValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;name should be a non-empty string&#39;</span>

<span class="k">class</span> <span class="nc">InvalidSurfaceError</span><span class="p">(</span><span class="n">ClassFieldValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be between 0 and 10000 and be a multiple of 100.&#39;</span>

<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidNameError</span><span class="p">)</span>
<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
                <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurfaceError</span><span class="p">)</span>
<span class="nd">@attr.s</span>
<span class="k">class</span> <span class="nc">House</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">()</span>
    <span class="n">surface</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">h</span> <span class="o">=</span> <span class="n">House</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">)</span>  <span class="c1"># Valid (surface is nonable by generated signature)</span>

<span class="n">h</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>       <span class="c1"># DOES NOT RAISE InvalidNameError (no setter!)</span>

<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">InvalidNameError</span><span class="p">):</span>
    <span class="n">House</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># InvalidNameError</span>

<span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">InvalidSurfaceError</span><span class="p">):</span>
    <span class="n">House</span><span class="p">(</span><span class="s1">&#39;sweet home&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># InvalidSurfaceError</span>
</pre></div>


<p>As of today <code>attrs</code> does not transform fields into descriptors or properties so there is no way to add validation to field setters. Note that this is actually also the case if you rely on the validation mechanisms built in attrs, as explained <a href="http://www.attrs.org/en/stable/examples.html#callables">here</a>. This feature has been requested <a href="https://github.com/python-attrs/attrs/issues/160">here</a>.</p>
<h2 id="main-features">Main features<a class="headerlink" href="#main-features" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Separation of validation intent</strong> (entry points) <strong>from validation means</strong> (base validation functions). Entry points provide a clear and consistent behaviour matching your applicative intent, hiding the diversity of base validation functions that you rely on to do it.</p>
</li>
<li>
<p><strong>Clear entry points</strong> to serve most common needs related with validation:</p>
<ul>
<li>
<p><em>Inline validation</em>: two functions <code>assert_valid</code> and <code>is_valid</code>, to perform validation anywhere in your code in defensive programming mode (<code>assert_valid</code>) or case handling mode (<code>is_valid</code>)</p>
</li>
<li>
<p><em>Function validation</em>: two decorators <code>@validate_arg</code> and <code>@validate_out</code>, as well as a more limited <code>@validate</code>, to add input and output validation to any function. A manual decorator <code>decorate_with_validation</code> provides the same functionality for retrofit purposes.</p>
</li>
</ul>
</li>
<li>
<p><strong>Consistent behaviour</strong>: all defensive mode entry points provide the same behaviour, raising subclasses of <code>ValidationError</code> in case of failure, whatever the diversity of failure modes that can happen in base validation functions. The exception object contains all contextual information in its fields so as to be easily usable by a global exception handler at application-level, for example for internationalization. Consistency is ensured by the fact that all entry points rely on a <strong>common <code>Validator</code> class</strong>, which can also be used for advanced purposes, such as speeding up inline validation by creating validators ahead of time.</p>
</li>
<li>
<p><strong>Highly customizable</strong>: all entry points can be customized so as to fit your application needs. In particular you probably do not want users to see <code>valid8</code> exceptions and messages, but rather <em>your</em> exceptions and messages. This is easy to do with the two <code>help_msg</code> and <code>error_type</code> options.</p>
</li>
<li>
<p><strong>Compliant with most validation functions out there</strong>. You may use base validation functions from anywhere including your own, and including <code>functools.partial</code>, <code>lambda</code> or even callable objects implementing the <code>__call__</code> magic method. The <em>only</em> requirement is that they return <code>True</code> or <code>None</code> in case of success ! The way they fail is not important, <code>valid8</code> tolerates all. </p>
</li>
<li>
<p><strong>Built-in <a href="./base_validation_lib">library</a> of base validation functions</strong>, by object type. Do not hesitate to contribute! Also, do not hesitate to rely on other libraries for dedicated object types such as <a href="./other_libs#domain-specific-validators-validators-for-specific-data-types-validators-without-framework">these</a>, or to build your own !</p>
</li>
<li>
<p><strong>Built-in support for <a href="https://smarie.github.io/python-mini-lambda/">mini_lambda</a></strong> to define base validation functions, so that you do not need to write <code>lambda x:</code> everywhere, and the failure messages are far more easy to read.</p>
</li>
<li>
<p><strong>Tools to build user-friendly base validation functions</strong>. Three exception classes <code>Failure</code>, <code>WrappingFailure</code> and <code>CompositionFailure</code>, are provided as goodies if you wish to write your own validation functions while providing a maximum amount of details in the raised failure exception. You can find some inspiration <a href="https://github.com/smarie/python-valid8/blob/master/valid8/validation_lib/collections.py">here</a>. As explained above this is not mandatory, as <code>valid8</code> will catch any kind of failure even without exception.</p>
</li>
<li>
<p><strong>Composition of base validation functions</strong>. Built-in functions <code>and_</code>, <code>or_</code>, <code>xor_</code>, <code>not_</code>, <code>not_all</code>, <code>failure_raiser</code>, <code>skip_on_none</code> and <code>fail_on_none</code> allow you to quickly create complex validation functions by reusing simpler ones, if you do not want to do it using <code>lambda</code> or <code>mini_lambda</code>. Note that <code>and_</code> is implicitly used if you provide a list of base validation functions to any of the <code>valid8</code> entry points.</p>
</li>
<li>
<p><strong>python-first, not schema-first</strong>. This library is intended to provide validation anywhere in your code, not only when data enters a web service, a CLI or a form. There already are <a href="./other_libs#validation-of-data-at-the-entry-point">libs out there</a> for that purpose. <code>valid8</code> is rather meant to be as simple as possible and as open as possible to any kind of validation, even those that can not easily be described in a schema. To bridge the gap, maybe it will be useful at some point to provide a more restrictive class of base validation objects so that users may be able to generate a schema from a function annotated with <code>@validate_arg</code>. Of course, only if interest is confirmed...</p>
</li>
<li>
<p><strong>Separation of <em>value</em> validation from <em>type</em> validation</strong>. Using <code>valid8</code> for function input validation is compliant with the use of any PEP484-based type validation library such as <code>enforce</code> or <code>pytypes</code>.</p>
</li>
<li>
<p><strong>Compliant with <a href="https://github.com/smarie/python-autoclass">autoclass</a></strong>. Declare validation once by annotating the class constructor with <code>@validate</code> or <code>@validate_arg</code>, and the generated property setters will be validated too!</p>
</li>
</ul>
<h2 id="other-validation-libraries">Other Validation libraries<a class="headerlink" href="#other-validation-libraries" title="Permanent link">&para;</a></h2>
<p>Many validation libraries are available on <a href="https://pypi.python.org/pypi?%3Aaction=search&amp;term=valid&amp;submit=search">PyPI</a> already. The following <a href="./other_libs">list</a> is by far not exhaustive, but gives an overview. Do not hesitate to contribute to this list with a pull request! </p>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li>I opened this <a href="https://groups.google.com/forum/#!topic/python-ideas/ZSp9UKmnF2Q">discussion on python-ideas</a> to suggest a <code>validate</code> statement, functional equivalent of <code>assert_valid</code>, that would be built-in the python syntax so as to reduce parenthesis. Feel free to jump in !</li>
<li><a href="http://decorator.readthedocs.io/en/stable/">decorator</a> library, which provides everything one needs to create complex decorators easily (signature and annotations-preserving decorators, decorators with class factory) as well as provides some useful decorators (<code>@contextmanager</code>, <code>@blocking</code>, <code>@dispatch_on</code>). We use it to preserve the signature of wrapped methods.</li>
<li>Julien Danjou's <a href="https://julien.danjou.info/blog/2016/python-exceptions-guide">Definitive Guide to Python Exceptions</a>. It was of great inspiration and help to design <code>valid8</code>'s exception hierarchy.</li>
</ul>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie?utf8=%E2%9C%93&amp;tab=repositories&amp;q=&amp;type=&amp;language=python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-valid8">https://github.com/smarie/python-valid8</a></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="why_validation/" title="Why validation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Why validation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="./assets/javascripts/application.ce2ab4bf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"."}})</script>
      
    
    
      
    
  </body>
</html>