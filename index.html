



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="./assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.5.0">
    
    
      
        <title>valid8</title>
      
    
    
      <link rel="stylesheet" href="./assets/stylesheets/application.2a88008a.css">
      
    
    
      <script src="./assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="." title="valid8" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                valid8
              </span>
              <span class="md-header-nav__topic">
                Home and usage
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/smarie/python-valid8/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    valid8
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/smarie/python-valid8/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Home and usage
      </label>
    
    <a href="." title="Home and usage" class="md-nav__link md-nav__link--active">
      Home and usage
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#do-i-need-a-validation-library" title="Do I need a validation library ?" class="md-nav__link">
    Do I need a validation library ?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" title="Installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-inline-validation" title="Usage - inline validation" class="md-nav__link">
    Usage - inline validation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-quick_valid" title="(a) quick_valid" class="md-nav__link">
    (a) quick_valid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-wrap_valid" title="(b) wrap_valid" class="md-nav__link">
    (b) wrap_valid
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-the-validationexception" title="Customizing the ValidationException" class="md-nav__link">
    Customizing the ValidationException
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-custom-message" title="(a) custom message" class="md-nav__link">
    (a) custom message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-custom-type" title="(b) custom type" class="md-nav__link">
    (b) custom type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-message-templating" title="(c) message templating" class="md-nav__link">
    (c) message templating
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validating-functions-classes" title="Validating functions &amp; classes" class="md-nav__link">
    Validating functions &amp; classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-functions" title="(a) functions" class="md-nav__link">
    (a) functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-class-fields" title="(b) class fields" class="md-nav__link">
    (b) class fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-testing-goodies" title="(c) testing goodies" class="md-nav__link">
    (c) testing goodies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-advanced-composition" title="(d) advanced composition" class="md-nav__link">
    (d) advanced composition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" title="Main features" class="md-nav__link">
    Main features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decorator-specific" title="decorator-specific" class="md-nav__link">
    decorator-specific
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-validation-libraries" title="Other Validation libraries" class="md-nav__link">
    Other Validation libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#origin-of-this-project" title="Origin of this project" class="md-nav__link">
    Origin of this project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" title="See Also" class="md-nav__link">
    See Also
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" title="Want to contribute ?" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="why_validation/" title="Why validation" class="md-nav__link">
      Why validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      For `valid8` decorators only
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        For `valid8` decorators only
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="accepted/" title="Accepted base validation functions" class="md-nav__link">
      Accepted base validation functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="base_validation_lib/" title="Built-in base validation functions" class="md-nav__link">
      Built-in base validation functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="composition/" title="Composing base validation functions" class="md-nav__link">
      Composing base validation functions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="valid8_with_other/" title="valid8 + other tools" class="md-nav__link">
      valid8 + other tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="other_libs/" title="Other validation libs" class="md-nav__link">
      Other validation libs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#do-i-need-a-validation-library" title="Do I need a validation library ?" class="md-nav__link">
    Do I need a validation library ?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installing" title="Installing" class="md-nav__link">
    Installing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-inline-validation" title="Usage - inline validation" class="md-nav__link">
    Usage - inline validation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-quick_valid" title="(a) quick_valid" class="md-nav__link">
    (a) quick_valid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-wrap_valid" title="(b) wrap_valid" class="md-nav__link">
    (b) wrap_valid
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customizing-the-validationexception" title="Customizing the ValidationException" class="md-nav__link">
    Customizing the ValidationException
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-custom-message" title="(a) custom message" class="md-nav__link">
    (a) custom message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-custom-type" title="(b) custom type" class="md-nav__link">
    (b) custom type
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-message-templating" title="(c) message templating" class="md-nav__link">
    (c) message templating
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validating-functions-classes" title="Validating functions &amp; classes" class="md-nav__link">
    Validating functions &amp; classes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-functions" title="(a) functions" class="md-nav__link">
    (a) functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#b-class-fields" title="(b) class fields" class="md-nav__link">
    (b) class fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-testing-goodies" title="(c) testing goodies" class="md-nav__link">
    (c) testing goodies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-advanced-composition" title="(d) advanced composition" class="md-nav__link">
    (d) advanced composition
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-features" title="Main features" class="md-nav__link">
    Main features
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#decorator-specific" title="decorator-specific" class="md-nav__link">
    decorator-specific
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-validation-libraries" title="Other Validation libraries" class="md-nav__link">
    Other Validation libraries
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#origin-of-this-project" title="Origin of this project" class="md-nav__link">
    Origin of this project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" title="See Also" class="md-nav__link">
    See Also
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#want-to-contribute" title="Want to contribute ?" class="md-nav__link">
    Want to contribute ?
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-valid8/edit/master/docs/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="python-validate-valid8">python-validate (valid8)<a class="headerlink" href="#python-validate-valid8" title="Permanent link">&para;</a></h1>
<p><a href="https://travis-ci.org/smarie/python-valid8"><img alt="Build Status" src="https://travis-ci.org/smarie/python-valid8.svg?branch=master" /></a> <a href="https://smarie.github.io/python-valid8/junit/report.html"><img alt="Tests Status" src="https://smarie.github.io/python-valid8/junit/junit-badge.svg?dummy=8484744" /></a> <a href="https://codecov.io/gh/smarie/python-valid8"><img alt="codecov" src="https://codecov.io/gh/smarie/python-valid8/branch/master/graph/badge.svg" /></a> <a href="https://smarie.github.io/python-valid8/"><img alt="Documentation" src="https://img.shields.io/badge/docs-latest-blue.svg" /></a> <a href="https://pypi.python.org/pypi/valid8/"><img alt="PyPI" src="https://img.shields.io/badge/PyPI-valid8-blue.svg" /></a></p>
<p><em>"valid8ing is not a crime" ;-)</em></p>
<p>Type and Value Validation in python is not straightforward. However it is key to smooth user experience for all of our libraries and applications. Good validation leads to less user frustration, but should not be at the cost of the developer's overall efficiency.</p>
<p>I searched and found tons of good and less good libraries <a href="#other-validation-libraries">out there</a>, but did not find any that would provide a somehow generic answer covering 80% of the needs - especially the particular needs I had for class attributes validation in <a href="https://smarie.github.io/python-autoclass/">autoclass</a>. </p>
<p>I therefore propose this library to the open source community, at least to create a reference and maybe one day (?) reach a satisfying solution for a significant amount of developers.</p>
<h2 id="do-i-need-a-validation-library">Do I need a validation library ?<a class="headerlink" href="#do-i-need-a-validation-library" title="Permanent link">&para;</a></h2>
<p>In <a href="./why_validation">this page</a>, we explain what is validation, what you would need to do in order to implement it correctly (<code>assert</code> is not a viable solution), and demonstrate how much effort that would cost you. This high development cost results in validation being done inconsistently, if not skipped totally, in many applications and libraries.</p>
<p><code>valid8</code> provides tools to perform validation in a minimum number of lines and with built-in consistency, so that it hopefully becomes fun and easy to include in your code. </p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>&gt; pip install valid8
</pre></div>


<p>Optional but recommended:</p>
<ul>
<li>
<p>If you wish to define your own validation functions dynamically you may wish to also install <a href="https://smarie.github.io/python-mini-lambda/">mini_lambda</a>.</p>
</li>
<li>
<p>Since <code>valid8</code> only provides simple <em>type</em> validation, it is recommended to also install a more capable PEP484 <em>type</em> checker such as <a href="https://github.com/RussBaz/enforce">enforce</a> of <a href="https://github.com/Stewori/pytypes">pytypes</a>.</p>
</li>
<li>
<p>In addition, if you wish to create highly compact object classes with field type+value validation, have a look at <a href="https://smarie.github.io/python-autoclass/">autoclass</a> which is where <code>valid8</code> actually originates from.</p>
</li>
</ul>
<h2 id="usage-inline-validation">Usage - inline validation<a class="headerlink" href="#usage-inline-validation" title="Permanent link">&para;</a></h2>
<p><code>valid8</code> provides two validation methods that you may use anywhere in your code: </p>
<ul>
<li><code>quick_valid</code> to perform the most simple validation tasks in one line of code</li>
<li><code>wrap_valid</code> for any other validation task, in two or more lines of code</li>
</ul>
<h3 id="a-quick_valid">(a) <code>quick_valid</code><a class="headerlink" href="#a-quick_valid" title="Permanent link">&para;</a></h3>
<p>The <code>quick_valid</code> method is the most straightforward, but less flexible, tool in this toolbox. It provides you with ways to quickly validate one or several of:</p>
<ul>
<li>value is not <code>None</code></li>
<li>value is an instance of one type in a <code>var_types</code> set</li>
<li>value is one of the elements in a <code>allowed_values</code> set </li>
<li>value is greater/smaller than <code>min_value</code>/<code>max_value</code> (strict or not)</li>
<li>value length is greater/smaller than <code>min_len</code> / <code>max_len</code> (strict or not).</li>
</ul>
<p>In case of failure, it raises the same kind of <code>ValidationError</code> objects than more elaborate validation methods provided below, so it is consistent with the rest of <code>valid8</code>. Besides, the exception <code>__cause__</code> is the same than the equivalent operators from the <a href="./base_validation_lib">valid8 base validation library</a>.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">quick_valid</span>

<span class="n">surf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="n">quick_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>results in</p>
<div class="codehilite"><pre><span></span>ValidationError: Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>-1<span class="o">]</span>. <span class="se">\</span>
   TooSmall: x &gt;<span class="o">=</span> <span class="m">0</span> does not hold <span class="k">for</span> <span class="nv">x</span><span class="o">=</span>-1. Wrong value: <span class="o">[</span>-1<span class="o">]</span>.
</pre></div>


<p>Note that the resulting exception object contains much of the available information (<code>var_name</code>, <code>var_value</code>, <code>validation_outcome</code>) as fields.</p>
<p>See <code>help(quick_valid)</code> for usage details.</p>
<h3 id="b-wrap_valid">(b) <code>wrap_valid</code><a class="headerlink" href="#b-wrap_valid" title="Permanent link">&para;</a></h3>
<p>The <code>wrap_valid</code> context manager is a bit more flexible than <code>quick_valid</code>: it allows you to define the validation procedure yourself, with any statement or function of your choice.</p>
<p>If you rely on <strong>functions that output a boolean flag indicating success</strong>, you simply have to plug that flag on the object provided by the context manager, as shown below:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">wrap_valid</span>

<span class="n">surf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="k">with</span> <span class="n">wrap_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
    <span class="n">v</span><span class="o">.</span><span class="n">alid</span> <span class="o">=</span> <span class="n">surf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">isfinite</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
</pre></div>


<p>Which yields</p>
<div class="codehilite"><pre><span></span>ValidationError: Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>-1<span class="o">]</span>:  <span class="se">\</span>
   validation <span class="k">function</span> <span class="o">[</span>v.alid <span class="o">=</span> surf &gt; <span class="m">0</span> and isfinite<span class="o">(</span>surf<span class="o">)]</span> returned <span class="o">[</span>False<span class="o">]</span>.
</pre></div>


<p>Note that the text of the error displays the source code that led to that failure. </p>
<p>If you rely on <strong>functions that may raise exceptions</strong>, <code>wrap_valid</code> will catch them and append them as the <code>__cause__</code> of the resulting <code>ValidationError</code>: </p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">wrap_valid</span>

<span class="n">surf</span> <span class="o">=</span> <span class="mi">1j</span>

<span class="k">with</span> <span class="n">wrap_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
    <span class="n">v</span><span class="o">.</span><span class="n">alid</span> <span class="o">=</span> <span class="n">surf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">isfinite</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
</pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span>ValidationError: Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>1j<span class="o">]</span>. <span class="se">\</span>
   Validation <span class="k">function</span> <span class="o">[</span>v.alid <span class="o">=</span> surf &gt; <span class="m">0</span> and isfinite<span class="o">(</span>surf<span class="o">)]</span> raised <span class="se">\</span>
       TypeError: <span class="s1">&#39;&gt;&#39;</span> not supported between instances of <span class="s1">&#39;complex&#39;</span> and <span class="s1">&#39;int&#39;</span>.
</pre></div>


<p>With <code>wrap_valid</code> you are therefore <strong>guaranteed</strong> that any exception happening in the validation process will be caught and turned into a friendly <code>ValidationError</code>, whatever the cause (<code>None</code> handling, known validation failures, unknown other errors). You therefore do not have to write the usual <a href="./why_validation#explicit-traditional-way">if/else/try/except wrappers</a> to handle all cases.</p>
<p>Two important things to note:</p>
<ul>
<li>the field name where you put the boolean flag does not matter, so if you prefer you can use alternate naming such as <code>with wrap_valid(...) as r:</code> and then <code>r.esults =</code></li>
<li>there is no need to feed any result to that boolean flag. If you rely on <em>failure raiser</em>-style base functions, for example a <code>check_uniform_sampling</code> or a <code>assert_series_equal</code>, just can just call them and the wrapper will assume that no exception means success:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="k">with</span> <span class="n">wrap_valid</span><span class="p">(</span><span class="s1">&#39;dataframe&#39;</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
    <span class="n">check_uniform_sampling</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">assert_series_equal</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span> <span class="n">ref_series</span><span class="p">)</span>
</pre></div>


<h2 id="customizing-the-validationexception">Customizing the <code>ValidationException</code><a class="headerlink" href="#customizing-the-validationexception" title="Permanent link">&para;</a></h2>
<p>Various options are provided to customize the raised exception. These options are available both on <code>quick_valid</code>, <code>wrap_valid</code>, and even on valid8 function and class decorators that we'll see below (<code>@validate_arg</code>, <code>@validate_field</code>...). </p>
<h3 id="a-custom-message">(a) custom message<a class="headerlink" href="#a-custom-message" title="Permanent link">&para;</a></h3>
<p>You can specify a custom error message that will be displayed at the beginning of the default message:</p>
<div class="codehilite"><pre><span></span><span class="k">with</span> <span class="n">wrap_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> 
                <span class="n">help_msg</span><span class="o">=</span><span class="s2">&quot;Surface should be a finite positive integer&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
    <span class="n">v</span><span class="o">.</span><span class="n">alid</span> <span class="o">=</span> <span class="n">surf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">isfinite</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
</pre></div>


<p>yields for <code>surf = -1</code></p>
<div class="codehilite"><pre><span></span>ValidationError: Surface should be a finite positive integer. <span class="se">\</span>
    Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>-1<span class="o">]</span>: <span class="se">\</span>
    validation <span class="k">function</span> <span class="o">[</span>v.alid <span class="o">=</span> surf &gt; <span class="m">0</span> and isfinite<span class="o">(</span>surf<span class="o">)]</span> returned <span class="o">[</span>False<span class="o">]</span>.
</pre></div>


<h3 id="b-custom-type">(b) custom type<a class="headerlink" href="#b-custom-type" title="Permanent link">&para;</a></h3>
<p>Or even better, a custom error type, which is a good practice to ease internationalization (unique applicative error codes). The base <code>ValidationError</code> class provides default behaviours allowing you to define subclasses in a quite compact form:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">InvalidSurface</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be a positive integer&#39;</span>

<span class="n">quick_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
            <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">)</span>
</pre></div>


<p>yields for <code>surf = -1</code></p>
<div class="codehilite"><pre><span></span>InvalidSurface: Surface should be a positive integer. <span class="se">\</span>
   Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>-1<span class="o">]</span>. <span class="se">\</span>
   TooSmall: x &gt;<span class="o">=</span> <span class="m">0</span> does not hold <span class="k">for</span> <span class="nv">x</span><span class="o">=</span>-1. Wrong value: <span class="o">[</span>-1<span class="o">]</span>.
</pre></div>


<h3 id="c-message-templating">(c) message templating<a class="headerlink" href="#c-message-templating" title="Permanent link">&para;</a></h3>
<p>Finally, the <code>help_msg</code> field acts as a string template that will receive any additional keyword argument thrown at the validation method. So you can define reusable error classes without too much hassle:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">InvalidSurface</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be &gt; {minimum}, found {var_value}&#39;</span>

<span class="n">quick_valid</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="n">surf</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
            <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>yields</p>
<div class="codehilite"><pre><span></span>InvalidSurface: Surface should be &gt; <span class="m">0</span>, found -1. <span class="se">\</span>
   Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>-1<span class="o">]</span>. <span class="se">\</span>
   TooSmall: x &gt;<span class="o">=</span> <span class="m">0</span> does not hold <span class="k">for</span> <span class="nv">x</span><span class="o">=</span>-1. Wrong value: <span class="o">[</span>-1<span class="o">]</span>.
</pre></div>


<p>Note: as shown in that last example, the value being validated is already sent to the help message string to format under the <code>'var_value'</code> key, so you do not need to pass it. </p>
<p>Obviously you can further customize your exception subclasses if you wish.</p>
<h2 id="validating-functions-classes">Validating functions &amp; classes<a class="headerlink" href="#validating-functions-classes" title="Permanent link">&para;</a></h2>
<p>In order to use the decorators presented in this section, you will have to provide them with a <strong>base validation function</strong> - as opposed to <code>quick_valid</code> where it was just a bunch of options, and <code>wrap_valid</code> where you could basically write any validation code inside the context manager.</p>
<p>The requirements for accepted base validation functions are extremely simple: any single-input function returning <code>True</code> or <code>None</code> in case of success is <a href="./accepted">accepted</a>. In order for you to get started quickly, you can even leverage the following existing tools:</p>
<ul>
<li>the bundled <a href="./base_validation_lib">validation functions library</a>.</li>
<li>the <a href="https://smarie.github.io/python-mini-lambda/"><code>mini_lambda</code></a> syntax to define some validation functions inline (such as <code>x &gt; 0</code>) without writing <code>lambda x:</code>. </li>
<li>the bundled <a href="./composition">composition functions</a></li>
</ul>
<h3 id="a-functions">(a) functions<a class="headerlink" href="#a-functions" title="Permanent link">&para;</a></h3>
<p>The <code>@validate_arg</code> decorator adds input validation to a function. Here is an example where we decorate a <code>build_house</code> function:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_arg</span><span class="p">,</span> <span class="n">instance_of</span>

<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> 
              <span class="n">help_msg</span><span class="o">=</span><span class="s1">&#39;name should be a non-empty string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_house</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Building house... DONE !&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span>
</pre></div>


<p>As you can see above, any number of base validation functions can be provided to the decorator - this will correspond to an implicit <code>and_</code> being performed, equivalent to one that you would have done with the <a href="./composition">composition framework</a>. Here we validate the input argument <code>name</code> by chaining the function <code>instance_of(str)</code> (from the built-in <a href="./base_validation_lib">validation functions library</a>) with a custom lambda function <code>Len(s) &gt; 0</code> created using the <a href="https://smarie.github.io/python-mini-lambda/"><code>mini_lambda</code></a> syntax. An implicit <code>and_</code> is done between the two.</p>
<p>Let's try it:</p>
<div class="codehilite"><pre><span></span>&gt; build_house<span class="o">(</span><span class="s1">&#39;sweet home&#39;</span>, <span class="m">200</span><span class="o">)</span>    <span class="c1"># Valid</span>

&gt; build_house<span class="o">(</span><span class="s1">&#39;&#39;</span>, <span class="m">200</span><span class="o">)</span>
InputValidationError: name should be a non-empty string. <span class="se">\</span>
   Error validating input <span class="o">[</span><span class="nv">name</span><span class="o">=]</span> <span class="k">for</span> <span class="k">function</span> <span class="o">[</span>build_house<span class="o">]</span>. <span class="se">\</span>
   Validation <span class="k">function</span> <span class="o">[</span>and<span class="o">(</span>instance_of_&lt;class <span class="s1">&#39;str&#39;</span>&gt;, len<span class="o">(</span>s<span class="o">)</span> &gt; <span class="m">0</span><span class="o">)]</span> raised <span class="se">\</span>
   AtLeastOneFailed: <span class="se">\</span>
     At least one validation <span class="k">function</span> failed validation <span class="k">for</span> value <span class="o">[]</span>. <span class="se">\</span>
     Successes: <span class="o">[</span><span class="s2">&quot;instance_of_&lt;class &#39;str&#39;&gt;&quot;</span><span class="o">]</span> / Failures: <span class="o">{</span><span class="s1">&#39;len(s) &gt; 0&#39;</span>: <span class="s1">&#39;False&#39;</span><span class="o">}</span>.
</pre></div>


<p>We can see in this verbose exception all details of interest: first the custom <code>help_msg</code>; then the validated function and input name; and finally the composition failure resulting from one of the two base functions failing (<code>len(s) &gt; 0</code> as stated). <em>Note that since <code>Len</code> is <code>mini_lambda</code>'s equivalent of <code>len</code>, the string representation is lowercase</em></p>
<p>The <code>@validate_out</code> function decorator works the same way for output validation, except that you don't provide it with any name. </p>
<p>Here is a more complete example with both input and output validation:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_arg</span><span class="p">,</span> <span class="n">validate_out</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>

<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
              <span class="n">help_msg</span><span class="o">=</span><span class="s1">&#39;name should be a non-empty string&#39;</span><span class="p">)</span>
<span class="nd">@validate_arg</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
              <span class="n">help_msg</span><span class="o">=</span><span class="s1">&#39;Surface should be a multiple of 100 between 0 and 10000.&#39;</span><span class="p">)</span>
<span class="nd">@validate_out</span><span class="p">(</span><span class="n">instance_of</span><span class="p">(</span><span class="nb">tuple</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">build_house</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Building house... DONE !&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span>
</pre></div>


<p>Something strange happens:</p>
<div class="codehilite"><pre><span></span>&gt; build_house<span class="o">(</span>None<span class="o">)</span>
InputValidationError: name should be a non-empty string. <span class="se">\</span>
   Error validating input <span class="o">[</span><span class="nv">name</span><span class="o">=</span>None<span class="o">]</span> ...

&gt; build_house<span class="o">(</span><span class="s1">&#39;sweet home&#39;</span><span class="o">)</span>         <span class="c1"># No error !</span>
&gt; build_house<span class="o">(</span><span class="s1">&#39;sweet home&#39;</span>, None<span class="o">)</span>   <span class="c1"># No error !</span>
</pre></div>


<p>No error is raised when <code>surface</code> is <code>None</code>, while our base validation functions should both fail in presence of <code>None</code>:</p>
<div class="codehilite"><pre><span></span>&gt; is_multiple_of<span class="o">(</span><span class="m">100</span><span class="o">)(</span>None<span class="o">)</span>   
TypeError: unsupported operand type<span class="o">(</span>s<span class="o">)</span> <span class="k">for</span> %: <span class="s1">&#39;NoneType&#39;</span> and <span class="s1">&#39;int&#39;</span>

&gt; <span class="o">(</span>Len<span class="o">(</span>s<span class="o">)</span> &gt; <span class="m">0</span><span class="o">)</span>.evaluate<span class="o">(</span>None<span class="o">)</span>
TypeError: object of <span class="nb">type</span> <span class="s1">&#39;NoneType&#39;</span> has no len<span class="o">()</span>
</pre></div>


<p>Indeed, by default <code>None</code> values have a special treatment depending on the function signature: </p>
<ul>
<li>if the input to validate has a default value of <code>None</code>it is considered <strong><em>nonable</em></strong>. For this input, <code>None</code> values will not enter the validation procedure and be sent directly to the function. In other words validation is skipped for <code>None</code>. The same principle goes for inputs and outputs that have a PEP484 <code>Optional[...]</code> type hint, with or without default value.</li>
<li>in the absence of <code>None</code> default value or <code>Optional[...]</code> type hint, the input or output is considered <strong><em>normal</em></strong>. <code>None</code> values will be send to the validation function as usual, as it would be for non-<code>None</code> values</li>
</ul>
<p>The default behaviour described above may not suit your needs, and can be changed by changing the <code>none_policy</code> keyword argument. Valid values are:</p>
<ul>
<li><code>NonePolicy.SKIP_IF_NONABLE_ELSE_VALIDATE</code>: the default behaviour described above</li>
<li><code>NonePolicy.SKIP_IF_NONABLE_ELSE_FAIL</code>: same than the above, except that for <strong><em>normal</em></strong> inputs and outputs, <code>None</code> values will be rejected automatically - no need to test for <code>None</code> in your validation function.</li>
<li><code>NonePolicy.SKIP</code>: validation will always be skipped for <code>None</code> values</li>
<li><code>NonePolicy.FAIL</code>: validation will always fail for <code>None</code> values</li>
<li><code>NonePolicy.VALIDATE</code>: validation will always be performed even for <code>None</code> values</li>
</ul>
<p>Finally, the exception customization options described <a href="#customizing-the-validationexception">earlier</a> apply. For example a custom <code>error_type</code> may be provided, except that the custom type should inherit from <code>InputValidationError</code> or <code>OutputValidationError</code>.</p>
<h3 id="b-class-fields">(b) class fields<a class="headerlink" href="#b-class-fields" title="Permanent link">&para;</a></h3>
<p>The <code>@validate_field</code> decorator adds field validation to a class. It is able to validate a field if the field is:</p>
<ul>
<li>a <a href="https://docs.python.org/3.6/howto/descriptor.html#descriptor-example">descriptor</a> - in which case it is equivalent to a <code>@validate_arg</code> added on the <code>__set__</code> function of the descriptor, but with a more user-friendly error message</li>
<li>a <a href="https://docs.python.org/3.6/howto/descriptor.html#properties">property</a>, in which case it is equivalent to a <code>@validate_arg</code> added on the <code>fset</code> function of the descriptor, but with a more user-friendly error message.</li>
<li>or a <em>constructor input</em>, in which case it is equivalent to a <code>@validate_arg</code> added on the constructor. In such case <strong>WARNING</strong> validation will only be called at initial object creation, not at subsequent field modifications!</li>
</ul>
<p>Here is an example where we add validation to a <code>House</code> class with two fields:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">valid8</span> <span class="kn">import</span> <span class="n">validate_field</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">,</span> <span class="n">is_multiple_of</span>
<span class="kn">from</span> <span class="nn">mini_lambda</span> <span class="kn">import</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Len</span>

<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">instance_of</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">Len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">help_msg</span><span class="o">=</span><span class="s1">&#39;name should be a non-empty string&#39;</span><span class="p">)</span>
<span class="nd">@validate_field</span><span class="p">(</span><span class="s1">&#39;surface&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="n">is_multiple_of</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
                <span class="n">help_msg</span><span class="o">=</span><span class="s1">&#39;Surface should be a multiple of100 between 0 and 10000&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">House</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surface</span> <span class="o">=</span> <span class="n">surface</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surface</span>

    <span class="nd">@surface.setter</span>
    <span class="k">def</span> <span class="nf">surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__surface</span> <span class="o">=</span> <span class="n">surface</span>
</pre></div>


<p>Let's try it:</p>
<div class="codehilite"><pre><span></span>&gt; <span class="nv">h</span> <span class="o">=</span> House<span class="o">(</span><span class="s1">&#39;sweet home&#39;</span><span class="o">)</span>  <span class="c1"># valid</span>

&gt; <span class="nv">h</span> <span class="o">=</span> House<span class="o">(</span><span class="s1">&#39;&#39;</span><span class="o">)</span>
ClassFieldValidationError: name should be a non-empty string. <span class="se">\</span>
   Error validating field <span class="o">[</span><span class="nv">name</span><span class="o">=]</span> <span class="k">for</span> class <span class="o">[</span>House<span class="o">]</span>. <span class="se">\</span>
   Validation <span class="k">function</span> <span class="o">[</span>and<span class="o">(</span>instance_of_&lt;class <span class="s1">&#39;str&#39;</span>&gt;, len<span class="o">(</span>s<span class="o">)</span> &gt; <span class="m">0</span><span class="o">)]</span> raised <span class="se">\</span>
   AtLeastOneFailed: <span class="se">\</span>
      At least one validation <span class="k">function</span> failed validation <span class="k">for</span> value <span class="o">[]</span>. <span class="se">\</span>
      Successes: <span class="o">[</span><span class="s2">&quot;instance_of_&lt;class &#39;str&#39;&gt;&quot;</span><span class="o">]</span> / Failures: <span class="o">{</span><span class="s1">&#39;len(s) &gt; 0&#39;</span>: <span class="s1">&#39;False&#39;</span><span class="o">}</span>

&gt; h.surface <span class="o">=</span> <span class="m">10000</span>
ClassFieldValidationError: Surface should be a multiple of <span class="m">100</span> between <span class="m">0</span> and <span class="m">10000</span>
   Error validating field <span class="o">[</span><span class="nv">surface</span><span class="o">=</span><span class="m">10000</span><span class="o">]</span> <span class="k">for</span> class <span class="o">[</span>House<span class="o">]</span>. <span class="se">\</span>
   Validation <span class="k">function</span> <span class="o">[</span>skip_on_none<span class="o">(</span>and<span class="o">((</span>x &gt;<span class="o">=</span> <span class="m">0</span><span class="o">)</span> <span class="p">&amp;</span> <span class="o">(</span>x &lt; <span class="m">10000</span><span class="o">)</span>, <span class="se">\</span>
                        is_multiple_of_100<span class="o">))]</span> <span class="se">\</span>
   raised AtLeastOneFailed: <span class="se">\</span>
      At least one validation <span class="k">function</span> failed validation <span class="k">for</span> value <span class="o">[</span><span class="m">10000</span><span class="o">]</span>. <span class="se">\</span>
      Successes: <span class="o">[</span><span class="s1">&#39;is_multiple_of_100&#39;</span><span class="o">]</span> <span class="se">\</span>
        / Failures: <span class="o">{</span><span class="s1">&#39;(x &gt;= 0) &amp; (x &lt; 10000)&#39;</span>: <span class="s1">&#39;False&#39;</span><span class="o">}</span>.

&gt; h.name <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># WARNING: does not raise ValidationError (no setter!)</span>
</pre></div>


<p>Once again, </p>
<ul>
<li>the default none policy is <code>SKIP_IF_NONABLE_ELSE_VALIDATE</code> but can be changed as we described in <a href="#a-functions">previous section</a></li>
<li>the exception customization options described <a href="#customizing-the-validationexception">earlier</a> apply. For example a custom <code>error_type</code> may be provided, except that the custom type should inherit from <code>ClassFieldValidationError</code>.</li>
</ul>
<h3 id="c-testing-goodies">(c) testing goodies<a class="headerlink" href="#c-testing-goodies" title="Permanent link">&para;</a></h3>
<p>It might be convient for you to be able to test your validation functions outside of a decorator. For this purpose you may wish to use the <code>assert_valid</code> function, which provides a similar signature, or the <code>Validator</code> object:</p>
<div class="codehilite"><pre><span></span>from mini_lambda import s, Len
from valid8 import assert_valid, Validator, instance_of

<span class="nv">name</span> <span class="o">=</span> <span class="s1">&#39;sweet_home&#39;</span>

<span class="c1"># validate name with the same base validation functions we used earlier</span>
assert_valid<span class="o">(</span><span class="s1">&#39;name&#39;</span>, name, instance_of<span class="o">(</span>str<span class="o">)</span>, Len<span class="o">(</span>s<span class="o">)</span> &gt; <span class="m">0</span>, 
             <span class="nv">help_msg</span><span class="o">=</span><span class="s1">&#39;name should be a non-empty string&#39;</span><span class="o">)</span>

<span class="c1"># same thing but in two steps</span>
<span class="nv">v</span> <span class="o">=</span> Validator<span class="o">(</span>instance_of<span class="o">(</span>str<span class="o">)</span>, Len<span class="o">(</span>s<span class="o">)</span> &gt; <span class="m">0</span>, 
              <span class="nv">help_msg</span><span class="o">=</span><span class="s1">&#39;name should be a non-empty string&#39;</span><span class="o">)</span>
v.assert_valid<span class="o">(</span><span class="s1">&#39;name&#39;</span>, name<span class="o">)</span>
</pre></div>


<h3 id="d-advanced-composition">(d) advanced composition<a class="headerlink" href="#d-advanced-composition" title="Permanent link">&para;</a></h3>
<p>We saw that all tools described in this section perform an implicit <code>and_</code> between all the base validation functions provided in their positional arguments. There is a fast way to transform any of these individually into a <em>failure raiser</em> function, if it is more of a <em>boolean tester</em>: simply use a tuple <code>(&lt;function&gt;, &lt;help_msg&gt;)</code> and it will raise a <code>Failure</code> with the provided help message in case of failure. You can even use a tuple <code>(&lt;function&gt;, &lt;exc_type&gt;)</code> to provide a custom exception type, as long as it is a subclass of <code>Failure</code>.</p>
<p>This mechanism is a way to add details if you feel that your functions are not very self-explicit, for example if you make great use of lambda expressions that return a boolean flag.</p>
<p>For example:</p>
<div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">InvalidSurface</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">help_msg</span> <span class="o">=</span> <span class="s1">&#39;Surface should be a multiple of 100 between 0 and 10000&#39;</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">Validator</span><span class="p">(((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">10000</span><span class="p">),</span> <span class="s1">&#39;Surface should be between 0 and 10000&#39;</span><span class="p">),</span>
             <span class="p">(</span><span class="n">x</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Surface should be a multiple of 100&#39;</span><span class="p">),</span>
              <span class="n">error_type</span><span class="o">=</span><span class="n">InvalidSurface</span><span class="p">)</span>
</pre></div>


<p>will raise the following two distinct error messages:</p>
<div class="codehilite"><pre><span></span>&gt; v.assert_valid<span class="o">(</span><span class="s1">&#39;surface&#39;</span>, -100<span class="o">)</span>
InvalidSurface: Surface should be a multiple of <span class="m">100</span> between <span class="m">0</span> and <span class="m">10000</span>. <span class="se">\</span>
   Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span>-1<span class="o">]</span>. <span class="se">\</span>
   Validation <span class="k">function</span> <span class="o">[</span>and<span class="o">((</span>x &gt;<span class="o">=</span> <span class="m">0</span><span class="o">)</span> <span class="p">&amp;</span> <span class="o">(</span>x &lt; <span class="m">10000</span><span class="o">)</span>, x % <span class="nv">100</span> <span class="o">==</span> <span class="m">0</span><span class="o">)]</span> raised <span class="se">\</span>
   AtLeastOneFailed: <span class="se">\</span>
      At least one validation <span class="k">function</span> failed validation. <span class="se">\</span>
      Successes: <span class="o">[</span><span class="s1">&#39;x % 100 == 0&#39;</span><span class="o">]</span> <span class="se">\</span>
      / Failures: <span class="o">{</span> <span class="se">\</span>
        <span class="s1">&#39;(x &gt;= 0) &amp; (x &lt; 10000)&#39;</span>: <span class="se">\</span>
            <span class="s1">&#39;WrappingFailure: Surface should be between 0 and 10000. \</span>
<span class="s1">            Function [(x &gt;= 0) &amp; (x &lt; 10000)] returned [False] for value [-1].&#39;</span> 
      <span class="o">}</span>.

&gt; v.assert_valid<span class="o">(</span><span class="s1">&#39;surface&#39;</span>, <span class="m">99</span><span class="o">)</span>
InvalidSurface: Surface should be a multiple of <span class="m">100</span> between <span class="m">0</span> and <span class="m">10000</span>. <span class="se">\</span>
   Error validating <span class="o">[</span><span class="nv">surface</span><span class="o">=</span><span class="m">99</span><span class="o">]</span>. <span class="se">\</span>
   Validation <span class="k">function</span> <span class="o">[</span>and<span class="o">((</span>x &gt;<span class="o">=</span> <span class="m">0</span><span class="o">)</span> <span class="p">&amp;</span> <span class="o">(</span>x &lt; <span class="m">10000</span><span class="o">)</span>, x % <span class="nv">100</span> <span class="o">==</span> <span class="m">0</span><span class="o">)]</span> raised <span class="se">\</span>
   AtLeastOneFailed: <span class="se">\</span>
      At least one validation <span class="k">function</span> failed validation. <span class="se">\</span>
      Successes: <span class="o">[</span><span class="s1">&#39;(x &gt;= 0) &amp; (x &lt; 10000)&#39;</span><span class="o">]</span> <span class="se">\</span>
      / Failures: <span class="o">{</span>
         <span class="s1">&#39;x % 100 == 0&#39;</span>: <span class="se">\</span>
            <span class="s1">&#39;WrappingFailure: Surface should be a multiple of 100. \</span>
<span class="s1">            Function [x % 100 == 0] returned [False] for value [99].&#39;</span>
      <span class="o">}</span>.
</pre></div>


<h2 id="main-features">Main features<a class="headerlink" href="#main-features" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Separation of validation intent</strong> (entry points <code>wrap_valid</code>, <code>@validate_arg</code>...) <strong>from validation means</strong> (base validation code / functions). Entry points provide a clear and consistent behaviour matching your applicative intent, hiding the diversity of base validation functions that you rely on to do it.</p>
</li>
<li>
<p>Clear entry points to <strong>serve most common needs</strong> related with validation:</p>
<ul>
<li>
<p><em>Inline validation</em>: two functions <code>quick_valid</code> and <code>wrap_valid</code> to perform validation anywhere in your code.</p>
</li>
<li>
<p><em>Function validation</em>: two decorators <code>@validate_arg</code> and <code>@validate_out</code>, as well as a more limited <code>@validate</code>, to add input and output validation to any function. A manual decorator <code>decorate_with_validation</code> provides the same functionality for retrofit purposes.</p>
</li>
<li>
<p><em>Class validation</em>: one decorator <code>@validate_field</code> to add validation to class fields.</p>
</li>
</ul>
</li>
<li>
<p><strong>Consistent behaviour</strong>: all defensive mode entry points provide the same behaviour, raising subclasses of <code>ValidationError</code> in case of failure, whatever the diversity of failure modes that can happen in base validation code. The exception object contains all contextual information in its fields so as to be easily usable by a global exception handler at application-level, for example for internationalization. Consistency is also ensured by the fact that all entry points rely on a common <code>Validator</code> class.</p>
</li>
<li>
<p><strong>Highly customizable</strong>: all entry points can be customized so as to fit your application needs. In particular you probably do not want users to see <code>valid8</code> exceptions and messages, but rather <em>your</em> exceptions and messages. This is easy to do with the two <code>help_msg</code> and <code>error_type</code> options.</p>
</li>
<li>
<p><strong>python-first, not schema-first</strong>. This library is intended to provide validation anywhere in your code, not only when data enters a web service, a CLI or a form. There already are <a href="./other_libs#validation-of-data-at-the-entry-point">libs out there</a> for that purpose. <code>valid8</code> is rather meant to be as simple as possible and as open as possible to any kind of validation, even those that can not easily be described in a schema.</p>
</li>
<li>
<p><strong>Separation of <em>value</em> validation from <em>type</em> validation is possible</strong>. <code>valid8</code> can be <a href="./valid8_with_other#pep484-type-checkers">combined</a> with any PEP484-based type validation library such as <code>enforce</code> or <code>pytypes</code>.</p>
</li>
<li>
<p><strong>Plays well with <a href="./valid8_with_other#autoclass">autoclass</a> and <a href="./valid8_with_other#attrs">attrs</a></strong>. Declare validation once by annotating the class with <code>@validate_field</code>, and you're good to go!</p>
</li>
</ul>
<h3 id="decorator-specific">decorator-specific<a class="headerlink" href="#decorator-specific" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Compliant with <a href="./accepted">most</a> base validation functions out there</strong>. You may use base validation functions from anywhere including your own, and including <code>functools.partial</code>, <code>lambda</code> or even callable objects implementing the <code>__call__</code> magic method. The <em>only</em> requirement is that they return <code>True</code> or <code>None</code> in case of success ! The way they fail is not important, <code>valid8</code> tolerates all. If you wish to create your own, you can leverage the three <a href="./accepted#built-in-exceptions">exception classes</a> provided. </p>
</li>
<li>
<p><strong>Built-in <a href="./base_validation_lib">library</a> of base validation functions</strong>, by object type. Do not hesitate to contribute! Also, do not hesitate to rely on other libraries for dedicated object types such as <a href="./other_libs#domain-specific-validators-validators-for-specific-data-types-validators-without-framework">these</a>, or to build your own !</p>
</li>
<li>
<p><strong>Built-in support for <a href="https://smarie.github.io/python-mini-lambda/">mini_lambda</a></strong> to define base validation functions for the decorators, so that you do not need to write <code>lambda x:</code> everywhere, and the failure messages are far more easy to read. Besides the global error customization as well as <strong>built-in syntax for <a href="#d-advanced-composition">failure raiser definition</a></strong> allows you to easily add exception details to lambda expressions.</p>
</li>
<li>
<p><strong>Built-in composition framework</strong>. Built-in functions <code>and_</code>, <code>or_</code>, <code>xor_</code>, <code>not_</code>, <code>not_all</code>, <code>failure_raiser</code>, <code>skip_on_none</code> and <code>fail_on_none</code> allow you to quickly create complex validation functions by reusing simpler ones, if you do not want to do it using <code>lambda</code> or <code>mini_lambda</code>. In particular, <code>and_</code> is implicitly used if you provide a list of base validation functions to any of the <code>valid8</code> decorators.</p>
</li>
</ul>
<h2 id="other-validation-libraries">Other Validation libraries<a class="headerlink" href="#other-validation-libraries" title="Permanent link">&para;</a></h2>
<p>Many validation libraries are available on <a href="https://pypi.python.org/pypi?%3Aaction=search&amp;term=valid&amp;submit=search">PyPI</a> already. The following <a href="./other_libs">list</a> is by far not exhaustive, but gives an overview. Do not hesitate to contribute to this list with a pull request! </p>
<h2 id="origin-of-this-project">Origin of this project<a class="headerlink" href="#origin-of-this-project" title="Permanent link">&para;</a></h2>
<p>When it all started, I was just looking for a library providing a <code>@validate</code> annotation with a basic library of validators and some logic to associate them, so as to complete <a href="https://smarie.github.io/python-autoclass/">autoclass</a>. I searched and found tons of good and less good libraries <a href="#other-validation-libraries">out there</a>. However none of them was really a good fit for <code>autoclass</code>, for diverse reasons:</p>
<ul>
<li>only a few of them were available as decorators</li>
<li>many of them were strongly mixing type validation and value validation, which is not necessary anymore thanks to PEP484. This was making the <code>autoclass</code> examples more confusing.</li>
<li>only a few of them were providing a simple yet consistent and reusable framework to deal with validation functions, combine them, etc. And the good ones were based on defining a Schema first, which seemed a bit 'too much' for me already.</li>
<li>finally, none of them was really encouraging the community to collaborate by displaying a catalog of base validation functions per data type, open to contributions.</li>
</ul>
<p>So I first created the <code>@validate</code> goodie in <a href="https://smarie.github.io/python-autoclass/">autoclass</a>. When the project became more mature, I decided to extract it and make it independent, so that maybe the community will find it interesting. </p>
<p>When this project grew, I found that its <a href="./base_validation_lib">embedded library of base validation functions</a> was not flexible enough to cover a large variety of use cases, and will probably <strong>never</strong> be even if we try our best, so I came up with the complementary <a href="https://smarie.github.io/python-mini-lambda/">mini_lambda syntax</a> which is now an independent project, typically used when your base validation function is very specific, but yet quite simple to write in plain python.</p>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li>We had this <a href="https://groups.google.com/forum/#!topic/python-ideas/ZSp9UKmnF2Q">discussion on python-ideas</a> to suggest a <code>validate</code> statement, functional equivalent of <code>assert_valid</code>, that would be built-in the python syntax so as to reduce parenthesis. An <a href="https://bugs.python.org/issue32590">issue</a> was also created.</li>
<li><a href="http://decorator.readthedocs.io/en/stable/">decorator</a> library, which provides everything one needs to create complex decorators easily (signature and annotations-preserving decorators, decorators with class factory) as well as provides some useful decorators (<code>@contextmanager</code>, <code>@blocking</code>, <code>@dispatch_on</code>). We use it to preserve the signature of wrapped methods.</li>
<li>Julien Danjou's <a href="https://julien.danjou.info/blog/2016/python-exceptions-guide">Definitive Guide to Python Exceptions</a>. It was of great inspiration and help to design <code>valid8</code>'s exception hierarchy.</li>
</ul>
<p><em>Do you like this library ? You might also like <a href="https://github.com/smarie?utf8=%E2%9C%93&amp;tab=repositories&amp;q=&amp;type=&amp;language=python">my other python libraries</a></em> </p>
<h2 id="want-to-contribute">Want to contribute ?<a class="headerlink" href="#want-to-contribute" title="Permanent link">&para;</a></h2>
<p>Details on the github page: <a href="https://github.com/smarie/python-valid8">https://github.com/smarie/python-valid8</a></p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
        
          <a href="why_validation/" title="Why validation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Why validation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="./assets/javascripts/application.ce2ab4bf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"."}})</script>
      
    
    
      
    
  </body>
</html>